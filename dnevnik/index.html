<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расписание</title>
    <style>
        :root {
            --bg-color: #fff3e0; /* Light autumn orange */
            --text-color: #3e2723; /* Dark brown */
            --accent-color: #e65100; /* Deep orange */
            --secondary-color: #ef6c00; /* Warm orange */
            --highlight-color: #ffb300; /* Amber */
            --shadow-color: rgba(0, 0, 0, 0.15);
            --red-pastel: #ffcccb; /* Pastel red for subjects */
            --blue-pastel: #add8e6; /* Pastel blue */
            --yellow-pastel: #fffacd; /* Pastel yellow */
            --orange-pastel: #ffdab9; /* Pastel orange */
            --green-pastel: #98fb98; /* Pastel green */
            --purple-pastel: #e6e6fa; /* Pastel purple */
            --gold: #ffd700; /* Gold for special events */
            --default-pastel: #f5f5f5; /* Default background */
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-image: linear-gradient(to bottom, rgba(255, 243, 224, 0.5), var(--bg-color)), url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"%3E%3Cpath fill="%23ef6c00" fill-opacity="0.1" d="M0,192L48,186.7C96,181,192,171,288,181.3C384,192,480,224,576,213.3C672,203,768,149,864,149.3C960,149,1056,203,1152,213.3C1248,224,1344,192,1392,176L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"%3E%3C/path%3E%3C/svg%3E');
            background-size: cover;
            background-position: bottom;
        }

        header {
            width: 100%;
            background-color: var(--accent-color);
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        .current-lesson {
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .gear-icon {
            font-size: 1.4rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .gear-icon:hover {
            transform: rotate(90deg);
        }

        section {
            width: 90%;
            max-width: 900px;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        h2 {
            color: var(--secondary-color);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--highlight-color);
            padding-bottom: 0.5rem;
        }

        .loading {
            color: var(--text-color);
            font-style: italic;
            font-size: 1rem;
        }

        .schedule-content {
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--shadow-color);
        }

        th {
            background-color: var(--secondary-color);
            color: white;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 6px var(--shadow-color);
        }

        button:hover {
            background-color: var(--highlight-color);
            transform: translateY(-2px);
        }

        footer {
            margin-top: auto;
            padding: 1rem;
            font-size: 0.9rem;
            color: var(--text-color);
            text-align: center;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <header>
        <div class="current-lesson">
            <span id="current-lesson-text">Нет текущего урока</span>
            <span class="gear-icon" onclick="openSettings()">⚙️</span>
        </div>
    </header>

    <section id="schedule">
        <h2>Расписание</h2>
        <p class="loading" id="schedule-loading">Подождите, расписание загружается...</p>
        <div class="schedule-content" id="schedule-content"></div>
    </section>

    <section id="electives">
        <h2>Расписание элективов</h2>
        <p class="loading" id="electives-loading">Подождите, расписание загружается...</p>
        <div class="schedule-content" id="electives-content"></div>
    </section>

    <div class="buttons">
        <button onclick="openCanteenMenu()">Открыть меню столовой</button>
        <!-- Убраны "Узнать, сколько дней до последнего звонка" и "Task Manager" -->
    </div>

    <footer>
        by Makrivich 2025 ver. r2.1.2
    </footer>

    <script>
        // URL для основного расписания и расписания элективов
        const MAIN_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1lWqIJaWWXceiE_CWyIdzMRLcRoQa-ulnT5tJfgLDo0o/export?format=csv&gid=0';
        const ELECTIVES_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1qS4JSUM2DqFgZhmiMfaJ8VU-t2DvpRtJyadEQkdxujA/export?format=csv';

        // Расписание звонков
        const SCHEDULE_WEEKDAYS = {
            '0 урок': '7:45–8:25',
            '1 урок': '8:30–9:10',
            '2 урок': '9:20–10:00',
            '3 урок': '10:15–10:55',
            '4 урок': '11:15–11:55',
            '5 урок': '12:15–12:55',
            '6 урок': '13:05–13:45',
            '7 урок': '13:55–14:35',
            '8 урок': '14:45–15:20'
        };

        const SCHEDULE_SATURDAY = {
            '0 урок': '7:45–8:25',
            '1 урок': '8:30–9:10',
            '2 урок': '9:20–10:00',
            '3 урок': '10:15–10:55',
            '4 урок': '11:10–11:50',
            '5 урок': '12:05–12:45',
            '6 урок': '12:55–13:35',
            '7 урок': '13:45–14:25',
            '8 урок': '14:45–15:20'
        };

        // Определение цвета карточки в зависимости от предмета
        function getSubjectColor(subject) {
            if (!subject || subject === 'Нет урока') return 'default-pastel';

            const subjectLower = subject.toLowerCase();
            if (subjectLower.includes('русский') || subjectLower.includes('английский')) {
                return 'red-pastel';
            } else if (
                subjectLower.includes('алгебра') ||
                subjectLower.includes('геометрия') ||
                subjectLower.includes('вис') ||
                subjectLower.includes('информатика') ||
                subjectLower.includes('физика') ||
                subjectLower.includes('электив по математике')
            ) {
                return 'blue-pastel';
            } else if (
                subjectLower.includes('литература') ||
                subjectLower.includes('проектная деятельность')
            ) {
                return 'yellow-pastel';
            } else if (
                subjectLower.includes('история') ||
                subjectLower.includes('обществознание') ||
                subjectLower.includes('разговоры о важном') ||
                subjectLower.includes('классный час') ||
                subjectLower.includes('профориентация')
            ) {
                return 'orange-pastel';
            } else if (
                subjectLower.includes('химия') ||
                subjectLower.includes('биология') ||
                subjectLower.includes('география')
            ) {
                return 'green-pastel';
            } else if (
                subjectLower.includes('физкультура') ||
                subjectLower.includes('обзр') ||
                subjectLower.includes('технология')
            ) {
                return 'purple-pastel';
            } else if (
                subjectLower.includes('последний звонок')
            ) {
                return 'gold';
            }
            return 'default-pastel';
        }

        async function fetchSchedule(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Не удалось загрузить данные: ' + response.status);
                }
                const text = await response.text();
                console.log('Полученные данные (сырой CSV):', text);
                const data = parseCSV(text);
                console.log('Распарсенные данные:', data);
                return data;
            } catch (error) {
                console.error('Ошибка загрузки данных:', error);
                return null;
            }
        }

        function parseCSV(text) {
            const rows = [];
            let currentRow = [];
            let currentCell = '';
            let insideQuotes = false;

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (char === '"') {
                    insideQuotes = !insideQuotes;
                } else if (char === ',' && !insideQuotes) {
                    currentRow.push(currentCell.trim());
                    currentCell = '';
                } else if (char === '\n' && !insideQuotes) {
                    currentRow.push(currentCell.trim());
                    rows.push(currentRow);
                    currentRow = [];
                    currentCell = '';
                } else {
                    currentCell += char;
                }
            }
            if (currentCell || currentRow.length > 0) {
                currentRow.push(currentCell.trim());
                rows.push(currentRow);
            }
            return rows;
        }

        // Функция для рендеринга расписания (пример, замените на вашу реализацию)
        function renderSchedule(data, containerId, isSaturday) {
            const container = document.getElementById(containerId);
            const loading = document.getElementById(`${containerId}-loading`);
            if (!data || data.length === 0) {
                loading.textContent = 'Ошибка: данные не загружены';
                return;
            }

            const schedule = isSaturday ? SCHEDULE_SATURDAY : SCHEDULE_WEEKDAYS;
            let html = '<table><tr><th>Время</th><th>Предмет</th><th>Кабинет</th></tr>';

            // Предполагаем, что CSV имеет структуру: [урок, предмет, кабинет, ...]
            // Первая строка — заголовки, пропускаем
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                const lessonNumber = row[0] || '';
                const subject = row[1] || 'Нет урока';
                const room = row[2] || '';
                const colorClass = getSubjectColor(subject);
                const time = schedule[lessonNumber] || '';

                html += `
                    <tr style="background-color: var(--${colorClass});">
                        <td>${time}</td>
                        <td>${subject}</td>
                        <td>${room}</td>
                    </tr>
                `;
            }

            html += '</table>';
            container.innerHTML = html;
            loading.style.display = 'none';
            container.style.display = 'block';
        }

        // Загрузка расписания
        async function loadSchedule() {
            const scheduleData = await fetchSchedule(MAIN_SHEET_URL);
            if (scheduleData) {
                const isSaturday = new Date().getDay() === 6;
                renderSchedule(scheduleData, 'schedule-content', isSaturday);
            }
        }

        async function loadElectives() {
            const electivesData = await fetchSchedule(ELECTIVES_SHEET_URL);
            if (electivesData) {
                renderSchedule(electivesData, 'electives-content', false);
            }
        }

        // Заглушка для кнопки "Открыть меню столовой" (замените на вашу логику)
        function openCanteenMenu() {
            console.log('Открывается меню столовой...');
            // Например: window.location.href = '/canteen-menu';
            // Или открытие модального окна:
            alert('Меню столовой открывается...');
        }

        // Заглушка для шестерёнки (замените на вашу логику)
        function openSettings() {
            console.log('Открываются настройки...');
            // Например, открытие модального окна настроек
            alert('Открыть настройки');
        }

        // Инициализация
        window.onload = () => {
            loadSchedule();
            loadElectives();
        };
    </script>
</body>
</html>
